if [[ "$#" -eq 0 ]]; then
  echo "Usage: ./test.sh [--restart]"
  exit 1
fi

# prev-compose
if [[ "$1" == "--run-test" ]]; then
  sudo docker compose up --force-recreate test-client
fi

# prev-compose
if [[ "$1" == "--stop" ]]; then
  sudo docker compose down
fi

# prev-compose
if [[ "$1" == "--restart" ]]; then
  sudo docker compose down
  sudo docker compose up -d
  sleep 11
  sudo docker logs mongo-test-client
fi

# current-compose
if [[ "$1" == "--test" ]]; then
  # echo "[⚙️]   Stopping any existing containers..."
  # sudo docker compose down

  # echo "[⚙️]   Starting MongoDB container..."
  # sudo docker compose up -d

  # echo "[⚙️]   Waiting for MongoDB to initialize (30 seconds)..."
  # sleep 30

  echo "[⚙️]   Running attack script..."
  python attack.py
fi

if [[ "$1" == "--down" ]]; then
  sudo docker compose down
fi