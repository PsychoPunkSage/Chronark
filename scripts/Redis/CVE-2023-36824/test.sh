#!/bin/bash

IMAGE_NAME="redis_cve_2023_36824"

function invalid_flag() {
  echo "Error: Invalid flag '$1'"
  echo "Usage: $0 (brun | enter | kill | logs)"
  exit 1
}

case "$1" in
  brun)
    echo "Building + Runnning Docker image..."
    docker build -t "$IMAGE_NAME" -f Dockerfile."$IMAGE_NAME" .
    docker run -d --name "$IMAGE_NAME" "$IMAGE_NAME"
    ;;
  enter)
    echo "Entering the container..."
    docker exec -it "$IMAGE_NAME" /bin/sh
    ;;
  kill)
    echo "Stopping and removing the container..."
    docker stop "$IMAGE_NAME"
    docker rm "$IMAGE_NAME"
    ;;
  logs)
    echo "Printing logs:....."
    docker exec -it "$IMAGE_NAME" cat /tmp/exploit.log
    ;;
  *)
    invalid_flag "$1"
    ;;
esac

exit 0
